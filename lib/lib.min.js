!function(e){"use strict";function t(e){var t=e.xhr,r=e.properties;return r.aborted?t:(r.resolved||r.rejected||(t.abort(),r.aborted=!0,r.path+=";aborted",delete n[r.id]),t)}function r(t){a||(o.abortAll(),Object.keys(n).length||(a=!0,e.removeEventListener("beforeunload",r,!1),e.removeEventListener("unload",r,!1)))}var o=function(){function e(e){return Math.random().toString(36).substr(2,e)}function r(e){var t=e.options,r=e.properties;r.locked=!0;var o={url:t.url||document.URL,method:(t.method||"GET").toUpperCase(),data:t.data||null,fileUpload:t.fileUpload||!1,async:!t.async||t.async,processData:!1!==t.processData,postJSON:t.postJSON||!1,parseJSON:t.parseJSON||!1,id:t.id||r.id,withCredentials:t.withCredentials||!1,responseType:t.responseType||"",timeout:t.timeout||1e4};r.id=o.id,o.cache=!!t.cache&&t.cache;var n=t.events||{},a=function(){};n={abort:n.abort||a,progress:n.progress||a,timeout:n.timeout||a,readystatechange:n.readystatechange||a,loadstart:n.loadstart||a,loadend:n.loadend||a,load:n.load||a,error:n.error||a};var s=t.headers||[];if(!o.fileUpload){for(var i=0,p=s.length;i<p&&"content-type"!==s[i][0].toLowerCase();i++)i===p-1&&s.push(["Content-Type","application/x-www-form-urlencoded;charset=UTF-8"]);s.length||s.push(["Content-Type","application/x-www-form-urlencoded;charset=UTF-8"])}return o.events=n,o.headers=s,e.options=o,o}function o(e){var t=e.xhr,r=e.properties.callbacks;for(var o in r)r.hasOwnProperty(o)&&t.removeEventListener(o,r[o],!1)}var a=function(e){return Object.prototype.toString.call(e).replace(/(\[object |\])/g,"").toLowerCase()};a.is=function(e,t){var r=this(e);return t="|"+t.toLowerCase().trim()+"|",Boolean(-~t.indexOf("|"+r+"|"))},a.isnot=function(e,t){return!this.is(e,t)};var s=function(e){var t=e.constructor__,r=e.methods__,o=e.extend__;o&&(t.prototype=Object.create(o.prototype),t.prototype.constructor=t);var n=t.prototype;for(var a in r)r.hasOwnProperty(a)&&(n[a]=r[a]);return t}({constructor__:function(t){if(!(this instanceof s))return new s;this.xhr=new XMLHttpRequest,this.xhr.responseJSON=null,this.options={},t&&(this.options.url=t),this.properties={id:e(22),callbacks:{},aborted:!1,locked:!1,opened:!1,resolved:void 0,rejected:void 0,path:"created"}},methods__:{url:function(e){var t=this;return t.properties.locked?t:(t.options.url=e,t)},method:function(e){var t=this;return t.properties.locked?t:(t.options.method=e,t)},data:function(e){var t=this;return t.properties.locked?t:(t.options.data=e,t)},fileUpload:function(e){var t=this;return t.properties.locked?t:(t.options.fileUpload=e,t)},postJSON:function(e){var t=this;return t.properties.locked?t:(t.options.postJSON=e,t)},parseJSON:function(e){var t=this;return t.properties.locked?t:(t.options.parseJSON=e,t)},cache:function(e){var t=this;return t.properties.locked?t:(t.options.cache=e,t)},async:function(e){var t=this;return t.properties.locked?t:(t.options.async=e,t)},header:function(e,t){var r=this;return r.properties.locked?r:(r.options.headers||(r.options.headers=[]),r.options.headers.push([e,t]),r)},processData:function(e){var t=this;return t.properties.locked?t:(t.options.processData=e,t)},id:function(e){var t=this;return t.properties.locked?t:(t.options.id=e,t)},withCredentials:function(e){var t=this;return t.properties.locked?t:(t.options.withCredentials=e,t)},responseType:function(e){var t=this;return t.properties.locked?t:(t.options.responseType=e,t)},timeout:function(e){var t=this;return t.properties.locked?t:(t.options.timeout=e,t)},events:function(e){var t=this;return t.properties.locked?t:(t.options.events=e,t)},run:function(){var e=this,t=e.xhr,s=r(e),i=e.properties,p=i.callbacks;if(i.opened)return e;var d=s.url,c=s.method,l=s.data,u=s.cache,h=s.async,v=s.processData,f=s.postJSON,y=s.parseJSON,m=s.id,b=s.credentials,w=s.responseType,g=s.timeout,O=s.headers,k=s.events,L=k.abort,S=k.progress,E=k.timeout,C=k.readystatechange,J=k.loadstart,N=k.loadend;return i.path+=";unsent",n[m]=e,new Promise(function(r,n){p.loadstart=J,p.loadend=N,p.load=function(n){if(i.path+=";done;resolved",i.resolved=!0,i.rejected=!1,o(e),y)try{t.responseJSON=JSON.parse(t.responseText)}catch(e){console.warn(e)}r(t)},p.error=function(r){i.path+=";done;rejected",i.resolved=!1,i.rejected=!0,o(e),n(t)},p.progress=function(e){if(e.lengthComputable){var r=e.loaded/e.total*100;S.call(t,e,r)}else S.call(t,e,null)},p.abort=function(r){i.path+=";aborted-callback",o(e),L.call(t,r)},p.timeout=function(r){i.path+=";timedout",o(e),E&&E.call(t,r),n(new TypeError("Request timedout."))},p.readystatechange=function(e){var r={1:";opened",2:";headers-received",3:";loading",4:";finished"};i.path+=r[t.readyState],C&&C.call(t,e)},t.timeout=g,u||(d+=(-1!==d.indexOf("?")?"&_=":"?_=")+(new Date).getTime()),t.open(c,d,h),i.opened=!0;for(var s=0,m=O.length;s<m;s++)t.setRequestHeader(O[s][0],O[s][1]);t.withCredentials=b,t.responseType=w;var k=a(l);if(!1!==v&&("string"===k||"object"===k)){if("string"==typeof l){for(var T=l.split("&"),_={},s=0,m=T.length;s<m;s++){var x=T[s].split("=");_[x[0]]=x[1]}l=_}var U="",s=0;for(var j in l)l.hasOwnProperty(j)&&(U+=(0!==s?"&":"")+encodeURIComponent(j)+"="+encodeURIComponent(l[j]),s++);l=U}if(f)try{l=JSON.stringify(l)}catch(e){console.warn(e)}t.addEventListener("loadstart",p.loadstart,!1),t.addEventListener("loadend",p.loadend,!1),t.addEventListener("progress",p.progress,!1),t.addEventListener("abort",p.abort,!1),t.addEventListener("timeout",p.timeout,!1),t.addEventListener("readystatechange",p.readystatechange,!1),t.addEventListener("load",p.load,!1),t.addEventListener("error",p.error,!1),t.send(l)})},getProp:function(e){var t=this,r=t.properties;if(e&&a(e)&&e in r&&r.hasOwnProperty(e))return r[e]},abort:function(){t(this)}},extend__:!1});return s}(),n={},a=!1;o.abortAll=function(){for(var e in n)n.hasOwnProperty(e)&&t(n[e])},e.addEventListener("beforeunload",r,!1),e.addEventListener("unload",r,!1);var s=e.app||(e.app={});(s.libs||(s.libs={})).http=o}(window);